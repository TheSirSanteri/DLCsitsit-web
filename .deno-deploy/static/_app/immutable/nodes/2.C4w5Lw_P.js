import"../chunks/DsnmJJEf.js";import{i as H}from"../chunks/UI-HHCHi.js";import{a8 as Q,a9 as X,T as Y,aa as Z,h as ee,w as _,ab as ae,_ as se,ac as te,$ as w,a1 as D,a as r,ad as F,a2 as k,a3 as oe,a6 as c,b as n,m as p,a4 as m,a5 as u,a7 as N}from"../chunks/9i0Um9ta.js";import{i as C}from"../chunks/COizlyut.js";import{r as P,a as V,b as re,n as $}from"../chunks/CcmC2VZp.js";import{g as le}from"../chunks/C5Z_5Yfa.js";function j(e,i,v=i){var f=new WeakSet;Q(e,"input",async l=>{var t=l?e.defaultValue:e.value;if(t=E(e)?I(t):t,v(t),_!==null&&f.add(_),await X(),t!==(t=i())){var d=e.selectionStart,g=e.selectionEnd;e.value=t??"",g!==null&&(e.selectionStart=d,e.selectionEnd=Math.min(g,e.value.length))}}),(ee&&e.defaultValue!==e.value||Y(i)==null&&e.value)&&(v(E(e)?I(e.value):e.value),_!==null&&f.add(_)),Z(()=>{var l=i();if(e===document.activeElement){var t=ae??_;if(f.has(t))return}E(e)&&l===I(e.value)||e.type==="date"&&!l&&!e.value||l!==e.value&&(e.value=l??"")})}function E(e){var i=e.type;return i==="number"||i==="range"}function I(e){return e===""?null:+e}var ne=w(`<div class="cookie-note svelte-188ma0o" role="region" aria-label="Cookie notice"><p class="ck-text svelte-188ma0o"><strong>Cookies:</strong> We only use essential cookies (for login/session and security).
        No analytics or marketing cookies.</p> <button class="ck-btn svelte-188ma0o" type="button" aria-label="Dismiss cookie notice">OK</button></div>`),ie=w('<p class="msg error svelte-188ma0o" role="alert"> </p>'),ce=w('<p class="msg success svelte-188ma0o"> </p>'),me=w('<section class="login-hero svelte-188ma0o" aria-labelledby="welcomeTitle"><!> <h1 id="welcomeTitle" class="title svelte-188ma0o">Welcome to the reservation tool for DLC-sitsis</h1> <p class="subtitle svelte-188ma0o">please login first.</p> <form class="login-form svelte-188ma0o"><label class="svelte-188ma0o"><span class="svelte-188ma0o">Username</span> <input name="username" type="text" autocomplete="username" required class="svelte-188ma0o"/></label> <label class="svelte-188ma0o"><span class="svelte-188ma0o">Password</span> <input name="password" type="password" autocomplete="current-password" required class="svelte-188ma0o"/></label> <button class="submit svelte-188ma0o" type="submit"> </button> <!> <!></form></section>');function pe(e,i){se(i,!1);let v=p(""),f=p(""),l=p(!1),t=p(""),d=p(""),g=p(!1);te(()=>{n(g,localStorage.getItem("cookieNoticeDismissed")!=="1")});function A(){localStorage.setItem("cookieNoticeDismissed","1"),n(g,!1)}async function G(a){a.preventDefault(),n(t,""),n(d,""),n(l,!0);function o(s){if(!s)return"now";const b=new Date(s);return new Intl.DateTimeFormat("fi-FI",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(b)}try{const s=await V("/api/login",{method:"POST",body:JSON.stringify({username:r(v),password:r(f)})}),b=s?.token??s?.jwt??s?.accessToken,B=s?.username??s?.user?.username??r(v);if(!b)throw new Error("Login response missing token");re.set({token:b,username:B});const q=await V("/api/reservations/window",{method:"GET"});q?.canReserve?(n(d,"Logged in successfully."),le("/products")):$.info(`reservations starts at ${o(q?.opensAt??null)}`)}catch(s){const b=s.message||"Login failed";n(t,""),$.error(b)}finally{n(l,!1)}}H();var y=me(),L=m(y);{var J=a=>{var o=ne(),s=c(m(o),2);u(o),F("click",s,A),k(a,o)};C(L,a=>{r(g)&&a(J)})}var S=c(L,6),T=m(S),M=c(m(T),2);P(M),u(T);var x=c(T,2),O=c(m(x),2);P(O),u(x);var h=c(x,2),K=m(h,!0);u(h);var W=c(h,2);{var R=a=>{var o=ie(),s=m(o,!0);u(o),D(()=>N(s,r(t))),k(a,o)};C(W,a=>{r(t)&&a(R)})}var U=c(W,2);{var z=a=>{var o=ce(),s=m(o,!0);u(o),D(()=>N(s,r(d))),k(a,o)};C(U,a=>{r(d)&&a(z)})}u(S),u(y),D(()=>{h.disabled=r(l),N(K,r(l)?"Signing inâ€¦":"Sign in")}),j(M,()=>r(v),a=>n(v,a)),j(O,()=>r(f),a=>n(f,a)),F("submit",S,G),k(e,y),oe()}export{pe as component};
